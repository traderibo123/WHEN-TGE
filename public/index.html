<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WHEN TGE? — Meme Maker</title>
<style>
  :root{ --bg:#0a0b0f; --fg:#e9eef3; --muted:#9aa6b2; --ring:#222634; }
  *{box-sizing:border-box}
  body{margin:0;background:#0a0b0f;color:#e9eef3;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:1000px;margin:24px auto;padding:16px}
  h1{margin:0 0 12px;font-size:22px}
  .grid{display:grid;gap:10px;grid-template-columns:1fr 1fr}
  @media (max-width:760px){ .grid{grid-template-columns:1fr} }
  label{font-size:12px;color:#9aa6b2}
  input,select{width:100%;padding:10px 12px;border-radius:10px;background:#0f121a;color:#e9eef3;border:1px solid #222634}
  .btn{cursor:pointer;border-radius:10px;padding:11px 14px;border:1px solid #222634;background:#131826;color:#fff;font-weight:600}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .canvas-wrap{margin-top:14px;display:flex;justify-content:center}
  canvas{width:100%;max-width:980px;border:1px solid #222634;border-radius:16px;background:#000}
  .tips{margin-top:10px;color:#9aa6b2;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <h1>WHEN TGE? — Basit Meme Uygulaması</h1>

  <div class="grid">
    <div>
      <label>Kendi X kullanıcı adın (opsiyonel, tweet’e eklenecek)</label>
      <input id="userHandle" placeholder="ör. traderibo123" />
      <div class="tips">Avatar, aynı origin'den <code>/api/avatar</code> ile çekilir (CORS güvenli).</div>
    </div>

    <div>
      <label>Proje seç (isim + X kullanıcı adı)</label>
      <select id="project"></select>
      <div class="tips">Tweet metninde proje otomatik <b>@etiket</b> ile mention edilir.</div>
    </div>
  </div>

  <div class="row">
    <button class="btn" id="renderBtn">Güncelle</button>
    <button class="btn" id="downloadBtn" disabled>PNG indir</button>
    <button class="btn" id="tweetBtn" disabled>X’te paylaş</button>
    <label class="btn" style="position:relative;overflow:hidden">
      Özel Logo Yükle
      <input id="logoFile" type="file" accept=".png,.svg,.jpg,.jpeg,.webp" style="position:absolute;inset:0;opacity:0;cursor:pointer">
    </label>
  </div>

  <div class="canvas-wrap">
    <canvas id="c" width="1200" height="1200" aria-label="Önizleme tuvali"></canvas>
  </div>

  <div class="tips">
    Düzen: Üst-sol <b>“WHEN TGE?”</b>, alt-sol avatar çemberi, sağda proje logosu çemberi. Logolar <code>/logos/&lt;slug&gt;.ext</code> olarak çağrılır.
  </div>
</div>

<script>
const PROJECTS = [{"name": "0G Labs", "handle": "0G_labs", "slug": "0g-labs"}, {"name": "Allora", "handle": "AlloraNetwork", "slug": "allora"}, {"name": "Anoma", "handle": "anoma", "slug": "anoma"}, {"name": "Billions Network", "handle": "billions_ntwk", "slug": "billions-network"}, {"name": "Bless", "handle": "theblessnetwork", "slug": "bless"}, {"name": "Cysic", "handle": "cysic_xyz", "slug": "cysic"}, {"name": "EverlynAI", "handle": "everlyn_ai", "slug": "everlynai"}, {"name": "Falcon Finance", "handle": "FalconStable", "slug": "falcon-finance"}, {"name": "Fogo", "handle": "FogoChain", "slug": "fogo"}, {"name": "Hana", "handle": "HanaNetwork", "slug": "hana"}, {"name": "GOAT Network", "handle": "goatrollup", "slug": "goat-network"}, {"name": "Infinex", "handle": "infinex", "slug": "infinex"}, {"name": "Irys", "handle": "irys_xyz", "slug": "irys"}, {"name": "Katana", "handle": "katana", "slug": "katana"}, {"name": "Lombard", "handle": "Lombard_Finance", "slug": "lombard"}, {"name": "Lumiterra", "handle": "lumiterragame", "slug": "lumiterra"}, {"name": "Mavryk", "handle": "MavrykNetwork", "slug": "mavryk"}, {"name": "MegaETH", "handle": "megaeth_labs", "slug": "megaeth"}, {"name": "Mira Network", "handle": "mira_network", "slug": "mira-network"}, {"name": "Mitosis", "handle": "MitosisOrg", "slug": "mitosis"}, {"name": "Momentum", "handle": "mmtfinance", "slug": "momentum"}, {"name": "Monad", "handle": "monad", "slug": "monad"}, {"name": "Moonbirds", "handle": "moonbirds", "slug": "moonbirds"}, {"name": "Multipli", "handle": "multiplifi", "slug": "multipli"}, {"name": "Novastro", "handle": "Novastro_xyz", "slug": "novastro"}, {"name": "Noya.ai", "handle": "NetworkNoya", "slug": "noya-ai"}, {"name": "OpenLedger", "handle": "OpenledgerHQ", "slug": "openledger"}, {"name": "PARADEX", "handle": "tradeparadex", "slug": "paradex"}, {"name": "Portal to BTC", "handle": "PortaltoBitcoin", "slug": "portal-to-btc"}, {"name": "Puffpaw", "handle": "puffpaw_xyz", "slug": "puffpaw"}, {"name": "Somnia", "handle": "Somnia_Network", "slug": "somnia"}, {"name": "Soul Protocol", "handle": "0xSoulProtocol", "slug": "soul-protocol"}, {"name": "Surf", "handle": "surf_copilot", "slug": "surf"}, {"name": "Symphony", "handle": "symphonyio", "slug": "symphony"}, {"name": "Theoriq", "handle": "TheoriqAI", "slug": "theoriq"}, {"name": "Thrive Protocol", "handle": "thriveprotocol", "slug": "thrive-protocol"}, {"name": "Turtle", "handle": "turtledotxyz", "slug": "turtle"}, {"name": "Union", "handle": "union_build", "slug": "union"}, {"name": "Warden Protocol", "handle": "wardenprotocol", "slug": "warden-protocol"}, {"name": "YEET", "handle": "yeet", "slug": "yeet"}, {"name": "Linea", "handle": "LineaBuild", "slug": "linea"}, {"name": "DAWN", "handle": "dawninternet", "slug": "dawn"}];

const SIZE = 1200, PADDING = 80;
const AVATAR_R = 210, LOGO_R = 120;
const AVATAR_POS = { x: PADDING + AVATAR_R, y: SIZE - PADDING - AVATAR_R };
const LOGO_POS   = { x: SIZE - PADDING - LOGO_R, y: SIZE/2 + 40 };

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

const userHandleEl = document.getElementById('userHandle');
const projectEl = document.getElementById('project');
const fileEl = document.getElementById('logoFile');
const renderBtn = document.getElementById('renderBtn');
const downloadBtn = document.getElementById('downloadBtn');
const tweetBtn = document.getElementById('tweetBtn');

let customLogoDataURL = null;

/* Projeleri select içine: "İsim — @handle" */
(function fillProjectSelect(){
  PROJECTS.forEach(function(p){
    var opt = document.createElement('option');
    opt.value = p.slug;
    opt.textContent = p.name + " — @" + p.handle;
    if (p.slug === "novastro") opt.selected = true;
    projectEl.appendChild(opt);
  });
})();

function drawTextWhenTGE() {
  var left = PADDING, top = PADDING + 40;
  ctx.save();
  ctx.textBaseline = "top"; ctx.textAlign = "left";
  ctx.shadowColor = "rgba(27,62,168,.9)"; ctx.shadowBlur = 18; ctx.shadowOffsetX = 6; ctx.shadowOffsetY = 6;
  ctx.lineJoin = "round"; ctx.lineWidth = 22; ctx.strokeStyle = "#ffd028";
  var fill = "#ff2d2d"; ctx.font = "900 200px Impact, Arial Black, system-ui, sans-serif";
  ctx.strokeText("WHEN", left, top); ctx.fillStyle = fill; ctx.fillText("WHEN", left, top);
  ctx.strokeText("TGE?", left, top + 230); ctx.fillStyle = fill; ctx.fillText("TGE?", left, top + 230);
  ctx.restore();
}

function circleImage(img, cx, cy, r) {
  ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.closePath(); ctx.clip();
  ctx.fillStyle = "#111418"; ctx.fillRect(cx-r, cy-r, r*2, r*2);
  if (img) ctx.drawImage(img, cx-r, cy-r, r*2, r*2);
  ctx.restore(); ctx.lineWidth = 16; ctx.strokeStyle = "#fff"; ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2); ctx.stroke();
}

function placeholderCircle(letter, color, r){
  letter = letter || "X"; color = color || "#7c5cff"; r = r || 400;
  var off = document.createElement('canvas'); off.width = off.height = r*2;
  var o = off.getContext('2d'); o.fillStyle = color; o.beginPath(); o.arc(r, r, r, 0, Math.PI*2); o.fill();
  o.fillStyle = "#fff"; o.font = "bold " + Math.floor(r*1.1) + "px Arial, sans-serif"; o.textAlign="center"; o.textBaseline="middle";
  o.fillText(letter.toUpperCase(), r, r+10); return off;
}

function loadImage(url){
  return new Promise(function(res, rej){
    var img = new Image();
    img.crossOrigin="anonymous";
    img.onload=function(){ res(img); };
    img.onerror=function(){ rej(new Error("load fail: "+url)); };
    img.src=url;
  });
}

/* Avatar: aynı origin proxy */
async function loadAvatarByHandle(raw){
  var h = (raw||"").trim().replace(/^@/,"");
  if(!h) return null;
  var url = "/api/avatar?handle=" + encodeURIComponent(h) + "&cb=" + Date.now();
  try { return await loadImage(url); } catch(e) { return null; }
}

/* Proje logosu */
async function loadProjectLogo(slug, nameFallback){
  nameFallback = nameFallback || "P";
  if (customLogoDataURL){ try { return await loadImage(customLogoDataURL); } catch(e){} }
  var base = "/logos/" + slug; var exts = [".png",".webp",".jpg",".svg"];
  for(var i=0;i<exts.length;i++){ var ext=exts[i]; try { return await loadImage(base+ext + "?cb=" + Date.now()); } catch(e){} }
  var letter = nameFallback ? nameFallback[0] : "P"; return placeholderCircle(letter, "#7c5cff", 200);
}

async function render(){
  ctx.fillStyle = "#000"; ctx.fillRect(0,0,SIZE,SIZE);
  drawTextWhenTGE();

  var userH = userHandleEl.value || "";
  var avatarImg = await loadAvatarByHandle(userH);
  if(!avatarImg){
    var letter = (userH.replace("@","")[0] || "X").toUpperCase();
    avatarImg = placeholderCircle(letter, "#444", AVATAR_R);
  }
  circleImage(avatarImg, AVATAR_POS.x, AVATAR_POS.y, AVATAR_R);

  var slug = projectEl.value;
  var proj = PROJECTS.find(function(p){ return p.slug===slug; }) || PROJECTS[0];
  var logoImg = await loadProjectLogo(slug, proj ? proj.name : "P");
  circleImage(logoImg, LOGO_POS.x, LOGO_POS.y, LOGO_R);

  downloadBtn.disabled = false;
  tweetBtn.disabled = false;
}

renderBtn.addEventListener('click', render);
userHandleEl.addEventListener('keydown', function(e){ if(e.key==="Enter"){ e.preventDefault(); render(); } });
projectEl.addEventListener('change', render);
fileEl.addEventListener('change', function(e){
  var f = e.target.files && e.target.files[0];
  if(!f){ customLogoDataURL = null; return; }
  var r = new FileReader();
  r.onload = function(ev){ customLogoDataURL = ev.target.result; render(); };
  r.readAsDataURL(f);
});
downloadBtn.addEventListener('click', function(){
  var a=document.createElement('a');
  a.download='when-tge.png';
  a.href=canvas.toDataURL('image/png');
  a.click();
});
tweetBtn.addEventListener('click', function(){
  var slug = projectEl.value;
  var p = PROJECTS.find(function(p){ return p.slug===slug; });
  var userH = (userHandleEl.value||"").trim().replace(/^@/,"");
  var text = "WHEN TGE? @" + p.handle + (userH ? " @" + userH : "");
  var intent = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(text);
  window.open(intent, "_blank");
});
render();
</script>
</body>
</html>
